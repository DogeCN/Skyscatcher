<!DOCTYPE html>
<html>

<head>
    <title>图片交互效果预览 - 增强版</title>
    <style>
        body {
            margin: 0;
            background: #1e1e1e;
            color: #c0c0c0;
            font-family: Arial, sans-serif;
            font-size: 1.6em;
            line-height: 2.1;
            padding: 60px 8%;
            transition: all 0.3s ease;
        }

        h1,
        h2 {
            font-weight: 400;
            margin: 2em 0 1em 0;
            font-size: 1.6em;
        }

        h1 {
            font-size: 2.2em;
            margin-top: 1em;
            color: #e0e0e0;
        }

        h2 {
            color: #d0d0d0;
            border-left: 4px solid #555;
            padding-left: 15px;
        }

        p {
            margin: 1.2em 0;
        }

        .q {
            width: 30px;
            height: 30px;
        }

        .lz {
            width: 50%;
            height: auto;
            border-radius: 6px;
            transition: all 0.4s ease;
            transform-origin: center center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            cursor: pointer;
        }

        .lz.large {
            width: 90%;
            margin: 20px auto;
        }

        .lz:hover {
            opacity: 0.9;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.7);
        }

        .img-container {
            display: block;
            text-align: center;
            margin: 25px auto;
            overflow: visible;
            transition: all 0.4s ease;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 20px;
            background: #555;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            background: #777;
            transform: translateY(-2px);
        }

        .btn-rotate {
            background: #3a6b8a;
        }

        .btn-rotate:hover {
            background: #4a8bb0;
        }

        .btn-zoom {
            background: #5a7a5a;
        }

        .btn-zoom:hover {
            background: #6b9a6b;
        }

        .btn-reset {
            background: #8a3a3a;
        }

        .btn-reset:hover {
            background: #b04a4a;
        }

        .status-bar {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 30px 0;
            padding: 15px;
            background: #2a2a2a;
            border-radius: 8px;
            flex-wrap: wrap;
        }

        .status-item {
            text-align: center;
            padding: 0 15px;
        }

        .status-label {
            font-size: 0.9em;
            color: #a0a0a0;
            margin-bottom: 5px;
        }

        .status-value {
            font-size: 1.1em;
            font-weight: bold;
            color: #e0e0e0;
        }

        .instructions {
            background: #2a2a2a;
            padding: 25px;
            border-radius: 8px;
            margin: 30px 0;
            border-left: 4px solid #555;
        }

        .instructions h3 {
            color: #d0d0d0;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .instructions ul {
            list-style-type: none;
            padding-left: 10px;
        }

        .instructions li {
            margin-bottom: 10px;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .instructions li:before {
            content: "•";
            color: #5a7a5a;
            font-weight: bold;
            font-size: 1.2em;
        }

        @media (max-width: 768px) {
            body {
                padding: 30px 5%;
                font-size: 1.4em;
            }

            .lz {
                width: 85%;
            }

            .lz.large {
                width: 95%;
            }

            .status-bar {
                flex-direction: column;
                gap: 15px;
            }

            .controls {
                flex-direction: column;
                align-items: center;
            }

            .btn {
                width: 100%;
                max-width: 300px;
            }
        }

        /* 布局调整 */
        .layout-adjusted .img-container {
            margin: 35px auto;
        }

        /* 动画效果 */
        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .fade-in {
            animation: fadeIn 0.5s ease forwards;
        }

        /* 旋转动画 */
        @keyframes rotateContinuous {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        .rotating {
            animation: rotateContinuous 2s linear infinite;
        }
    </style>
</head>

<body>
    <h1>图片交互效果测试 - 增强版</h1>

    <div class="status-bar">
        <div class="status-item">
            <div class="status-label">当前模式</div>
            <div class="status-value" id="currentMode">等待操作</div>
        </div>
        <div class="status-item">
            <div class="status-label">旋转角度</div>
            <div class="status-value" id="rotationAngle">0°</div>
        </div>
        <div class="status-item">
            <div class="status-label">缩放状态</div>
            <div class="status-value" id="zoomStatus">正常</div>
        </div>
    </div>

    <div class="controls">
        <button class="btn btn-zoom" onclick="toggleZoomAll()">
            <span>🔍</span> 切换所有图片缩放
        </button>
        <button class="btn btn-rotate" onclick="rotateAll()">
            <span>🔄</span> 旋转所有图片
        </button>
        <button class="btn btn-reset" onclick="resetAll()">
            <span>↺</span> 重置所有图片
        </button>
        <button class="btn btn-rotate" onclick="toggleContinuousRotation()">
            <span>🔄</span> 连续旋转
        </button>
    </div>

    <h2>操作说明</h2>

    <div class="instructions">
        <h3>📋 交互指南</h3>
        <ul>
            <li><strong>单击图片</strong>：放大/缩小图片</li>
            <li><strong>双击图片</strong>：顺时针旋转图片90度（可连续旋转）</li>
            <li><strong>右键点击图片</strong>：逆时针旋转图片90度</li>
            <li>使用上方控制按钮可批量操作所有图片</li>
            <li>"连续旋转"按钮可使图片持续旋转</li>
        </ul>
    </div>

    <p>这是一些测试文本，用来展示图片在文档流中的表现。当图片旋转或缩放时，周围的布局会自动调整。</p>

    <div class="img-container">
        <img class="lz" src="https://images.unsplash.com/photo-1506744038136-46273834b3fb" alt="Mountain Landscape"
            onclick="handleImageClick(this)" ondblclick="rotateImage(this)"
            oncontextmenu="rotateImageCounterClockwise(this); return false;">
    </div>

    <p>图片之间的文本内容，用来测试排版效果。当图片旋转时，容器大小会自动调整，确保文本流正确排列。</p>

    <div class="img-container">
        <img class="lz" src="https://images.unsplash.com/photo-1518837695005-2083093ee35b" alt="Ocean View"
            onclick="handleImageClick(this)" ondblclick="rotateImage(this)"
            oncontextmenu="rotateImageCounterClockwise(this); return false;">
    </div>

    <p>更多文本内容，观察图片旋转和缩放对排版的影响。这个增强版解决了旋转后布局不跟随改变的问题。</p>

    <script>
        // 存储所有图片的状态
        const imageStates = new Map();
        let layoutAdjusted = false;
        let continuousRotationActive = false;

        // 初始化函数
        function initialize() {
            const images = document.querySelectorAll('.lz');
            images.forEach(img => {
                const id = img.src;
                imageStates.set(id, {
                    rotation: 0,
                    isZoomed: false,
                    naturalWidth: img.naturalWidth,
                    naturalHeight: img.naturalHeight
                });

                // 添加淡入效果
                img.classList.add('fade-in');
            });

            updateStatusDisplay();
        }

        // 处理图片点击（缩放）
        function handleImageClick(img) {
            const id = img.src;
            const state = imageStates.get(id) || { rotation: 0, isZoomed: false };

            state.isZoomed = !state.isZoomed;
            imageStates.set(id, state);

            img.classList.toggle('large');

            adjustLayout();
        }

        // 旋转图片（顺时针）
        function rotateImage(img) {
            // 如果连续旋转模式激活，则不执行单次旋转
            if (continuousRotationActive) return;

            const id = img.src;
            const state = imageStates.get(id) || { rotation: 0, isZoomed: false };

            // 更新旋转角度（连续增加，不重置）
            state.rotation += 90;
            imageStates.set(id, state);

            // 应用旋转
            img.style.transform = `rotate(${state.rotation}deg)`;

            // 更新状态显示
            document.getElementById('rotationAngle').textContent = state.rotation + '°';
            document.getElementById('currentMode').textContent = '图片已旋转: ' + state.rotation + '°';

            // 调整布局
            adjustLayout();
        }

        // 旋转图片（逆时针）
        function rotateImageCounterClockwise(img) {
            const id = img.src;
            const state = imageStates.get(id) || { rotation: 0, isZoomed: false };

            // 更新旋转角度（连续减少）
            state.rotation -= 90;
            imageStates.set(id, state);

            // 应用旋转
            img.style.transform = `rotate(${state.rotation}deg)`;

            // 更新状态显示
            document.getElementById('rotationAngle').textContent = state.rotation + '°';
            document.getElementById('currentMode').textContent = '图片已旋转: ' + state.rotation + '°';

            // 调整布局
            adjustLayout();
        }

        // 切换连续旋转
        function toggleContinuousRotation() {
            continuousRotationActive = !continuousRotationActive;
            const images = document.querySelectorAll('.lz');

            if (continuousRotationActive) {
                // 启动连续旋转
                images.forEach(img => {
                    img.classList.add('rotating');
                    // 保存当前旋转角度
                    const id = img.src;
                    const state = imageStates.get(id) || { rotation: 0, isZoomed: false };
                    img.style.transform = `rotate(${state.rotation}deg)`; // 设置当前角度
                });
                document.getElementById('currentMode').textContent = '连续旋转模式';
            } else {
                // 停止连续旋转
                images.forEach(img => {
                    img.classList.remove('rotating');
                    // 保存停止时的旋转角度
                    const id = img.src;
                    const computedStyle = window.getComputedStyle(img);
                    const matrix = new DOMMatrixReadOnly(computedStyle.transform);
                    const angle = Math.round(Math.atan2(matrix.b, matrix.a) * (180 / Math.PI));
                    const state = imageStates.get(id) || { rotation: 0, isZoomed: false };
                    state.rotation = angle;
                    imageStates.set(id, state);
                    img.style.transform = `rotate(${angle}deg)`;
                });
                document.getElementById('currentMode').textContent = '已停止连续旋转';
                document.getElementById('rotationAngle').textContent = imageStates.get(images[0].src).rotation + '°';
            }
        }

        // 调整布局以适应图片旋转/缩放
        function adjustLayout() {
            if (!layoutAdjusted) {
                document.body.classList.add('layout-adjusted');
                layoutAdjusted = true;
            }

            // 根据图片状态调整容器
            const images = document.querySelectorAll('.lz');
            images.forEach(img => {
                const container = img.parentElement;
                const state = imageStates.get(img.src) || { rotation: 0, isZoomed: false };

                // 根据旋转角度调整容器
                if (state.rotation % 180 !== 0) {
                    // 非0或180度旋转 - 调整容器宽高比
                    if (state.isZoomed) {
                        container.style.maxWidth = '90%';
                    } else {
                        container.style.maxWidth = '50%';
                    }
                } else {
                    // 0或180度旋转 - 恢复正常宽高比
                    container.style.maxWidth = '';
                }
            });
        }

        // 更新状态显示
        function updateStatusDisplay() {
            // 可以添加更多状态更新逻辑
        }

        // 批量操作函数
        function toggleZoomAll() {
            const images = document.querySelectorAll('.lz');
            images.forEach(img => {
                handleImageClick(img);
            });
        }

        function rotateAll() {
            const images = document.querySelectorAll('.lz');
            images.forEach(img => {
                rotateImage(img);
            });
        }

        function resetAll() {
            // 停止连续旋转
            if (continuousRotationActive) {
                toggleContinuousRotation();
            }

            const images = document.querySelectorAll('.lz');
            images.forEach(img => {
                // 重置旋转
                const id = img.src;
                const state = imageStates.get(id) || { rotation: 0, isZoomed: false };
                state.rotation = 0;
                imageStates.set(id, state);

                // 移除所有样式
                img.style.transform = '';
                img.classList.remove('large', 'rotating');

                // 重置容器样式
                const container = img.parentElement;
                container.style.maxWidth = '';
            });

            // 更新状态显示
            document.getElementById('rotationAngle').textContent = '0°';
            document.getElementById('zoomStatus').textContent = '正常';
            document.getElementById('currentMode').textContent = '已重置所有图片';

            // 恢复布局
            document.body.classList.remove('layout-adjusted');
            layoutAdjusted = false;
        }

        // 初始化
        window.onload = initialize;
    </script>
</body>

</html>